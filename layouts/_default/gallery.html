{{ define "main" }}
<article class="gallery-page">
    <header class="gallery-header">
        <h1>{{ .Title }}</h1>
        {{ with .Description }}<p class="gallery-desc">{{ . }}</p>{{ end }}
        {{ with .Params.navLinks }}<div class="reference-nav">{{ range . }}<a href="{{ .url }}">{{ .label }}</a>{{ end }}</div>{{ end }}
    </header>

    {{ with .Content }}<div class="gallery-intro">{{ . }}</div>{{ end }}

    <div class="gallery-grid">
        {{ range .Params.images }}
        <figure class="gallery-item" data-full="{{ $.Params.imageBase }}/{{ .src }}">
            <img src="{{ $.Params.imageBase }}/{{ .src }}" alt="{{ .title }}" loading="lazy">
            <figcaption>
                <strong>{{ .title }}</strong>
                {{ with .caption }}<p>{{ . }}</p>{{ end }}
                {{ with .link }}<a href="{{ . }}" target="_blank" class="gallery-link">Learn more</a>{{ end }}
            </figcaption>
        </figure>
        {{ end }}
    </div>
</article>

<div id="lightbox" class="lightbox">
    <button class="lightbox-close" aria-label="Close">&times;</button>
    <img class="lightbox-img" src="" alt="">
    <div class="lightbox-caption"></div>
</div>

<script>
(function() {
    var lb = document.getElementById('lightbox');
    var lbImg = lb.querySelector('.lightbox-img');
    var lbCap = lb.querySelector('.lightbox-caption');
    var items = document.querySelectorAll('.gallery-item');

    items.forEach(function(item) {
        item.addEventListener('click', function(e) {
            if (e.target.closest('.gallery-link')) return;
            lbImg.src = item.dataset.full;
            lbImg.alt = item.querySelector('img').alt;
            lbCap.innerHTML = item.querySelector('figcaption').innerHTML;
            lb.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
    });

    lb.addEventListener('click', function(e) {
        if (e.target === lb || e.target.classList.contains('lightbox-close')) {
            lb.classList.remove('active');
            document.body.style.overflow = '';
        }
    });

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            lb.classList.remove('active');
            document.body.style.overflow = '';
        }
    });
})();
</script>
{{ end }}
